{% extends "base.html" %}
{% block title %}–ì–ª–∞–≤–Ω–∞—è{% endblock %}

{% block content %}
<div class="space-y-6">

  <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ -->
  <div class="card-dark elev-1 relief" style="padding:24px;">
    <div class="flex items-center justify-between gap-4">
      <div>
        <h1 class="text-2xl font-bold">
          {{ greet }}{% if uname %}, {{ uname }}{% endif %}!
        </h1>
        <p class="mt-1" style="color:var(--muted);">
          –°–µ–≥–æ–¥–Ω—è {{ now.strftime('%d.%m.%Y') }}. –ù–∏–∂–µ ‚Äî –¥–µ–¥–ª–∞–π–Ω—ã –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–µ 10 –¥–Ω–µ–π.
        </p>
      </div>

      <div class="hidden md:flex items-center gap-3">
        <a href="{{ url_for('calendar_page') }}" class="btn-dark btn-accent">
          üìÖ –û—Ç–∫—Ä—ã—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å
        </a>
        <a href="{{ url_for('subjects_page') }}" class="btn-dark">
          üìä –ë–∞–ª–ª—ã –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º
        </a>
      </div>
    </div>
  </div>

  <!-- –ë–ª–∏–∂–∞–π—à–∏–µ –¥–µ–¥–ª–∞–π–Ω—ã -->
  <div class="card-dark elev-1 relief" style="padding:24px;">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-semibold">–ë–ª–∏–∂–∞–π—à–∏–µ –¥–µ–¥–ª–∞–π–Ω—ã (10 –¥–Ω–µ–π)</h2>
      {% if current_user.is_authenticated and current_user.is_admin %}
        <a href="{{ url_for('admin_add_deadline') }}" class="btn-dark btn-accent">‚ûï –î–æ–±–∞–≤–∏—Ç—å</a>
      {% endif %}
    </div>

    {% if upcoming %}
      <ul class="divide-y" style="--tw-divide-color: var(--line);">
      {% for d in upcoming %}
        <li class="py-3 flex items-center justify-between">
          <div class="min-w-0">
            <div class="font-medium truncate">
              {% if d.subject %}
                <span style="color:var(--muted)">{{ d.subject }} ‚Ä¢ </span>
              {% endif %}
              {{ d.title }}
            </div>

            <div class="text-sm flex items-center gap-2" style="color:var(--muted)">
              <span>
                {{ d.due_at.strftime('%d.%m.%Y') }}{% if not d.all_day %}, {{ d.due_at.strftime('%H:%M') }}{% endif %}
              </span>

              {% if d.kind %}
                {% set k = (d.kind or '')|lower %}
                {% if '–ª–∞–±' in k %}
                  {% set chip = 'lab' %}
                {% elif '–¥–∑' in k %}
                  {% set chip = 'hw' %}
                {% elif '–∫–æ–Ω—Ç—Ä' in k %}
                  {% set chip = 'ctrl' %}
                {% elif '—Ç–∏–ø–æ–≤' in k or '—Ç—Ä' in k %}
                  {% set chip = 'typ' %}
                {% elif '–∫–æ–ª–ª–æ–∫' in k %}
                  {% set chip = 'kol' %}
                {% else %}
                  {% set chip = 'test' %}
                {% endif %}
                <span class="chip chip--{{ chip }}">{{ d.kind }}</span>
              {% endif %}
            </div>
          </div>

          <!-- –ò–∫–æ–Ω–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
          <div class="flex items-center gap-2">
            {% if d.link %}
              <a href="{{ d.link }}" target="_blank" rel="noopener" class="btn-dark" title="–û—Ç–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É">‚Üó</a>
            {% endif %}
            {% if d.file_path %}
              <a href="{{ url_for('download_attachment', fname=d.file_path) }}" class="btn-dark" title="–°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª">üìé</a>
            {% endif %}
          </div>
        </li>
      {% endfor %}
      </ul>
    {% else %}
      <p style="color:var(--muted)">–ù–∞ –±–ª–∏–∂–∞–π—à–∏–µ 10 –¥–Ω–µ–π –Ω–µ—Ç –¥–µ–¥–ª–∞–π–Ω–æ–≤ üéâ</p>
    {% endif %}
  </div>

</div>
{% endblock %}
